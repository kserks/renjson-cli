{"version":3,"sources":["webpack:///webpack/bootstrap c68cdebb95316be3dce8?c8ee","webpack:///./src/vnjson.js?caa5","webpack:///./src/minivents.js?f536"],"names":["plugin","Object","option","game","init","scenes","characters","util","pathNameSplit","ctx","scene","label","arr","obj","num","ev","emit","pathname","pathArr","split","on","event","handler","vnjs","setScene","sceneName","sceneObject","assign","setLabel","labels","err","Error","labelName","labelArray","parse","_obj","key","length","character","reply","aliase","next","prev","Events","target","events","empty","type","func","push","off","list","i","splice","e","slice","j","apply","call","arguments"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;ACrCA;;;;;;AAEA,KAAMA,SAAS,IAAIC,MAAJ,EAAf;AACA,KAAMC,SAAS,IAAID,MAAJ,EAAf;;AAEA,KAAIE,OAAO;AACPC,SAAM,EADC;AAEPC,WAAQ,EAFD;AAGPC,eAAY;AAHL,EAAX;;AAOA,KAAMC,OAAO;AACXC;AADW,EAAb;;AAIA;;;;AAIA,KAAIC,MAAM;AACRC,UAAM,OADE;AAERC,UAAM,OAFE;AAGRC,QAAK,EAHG;AAIRC,QAAK,IAJG;AAKRC,QAAK;AALG,EAAV;AAOA;;;;AAMA,KAAIC,KAAK,yBAAT,C,CAAsB;KAChBC,I,GAASD,E,CAATC,I;;AAEN;;;;AAGA,UAASR,aAAT,CAAuBS,QAAvB,EAAgC;AAC9B,OAAIC,UAAUD,SAASE,KAAT,CAAe,GAAf,CAAd;AACA,OAAIT,QAAQQ,QAAQ,CAAR,CAAZ;AACA,OAAIP,QAAQO,QAAQ,CAAR,CAAZ;AACA,UAAO,EAACP,YAAD,EAAQD,YAAR,EAAP;AACD;AACD;;;;AAIA;;;;;;;AAOA,UAASU,EAAT,CAAYC,KAAZ,EAAmBC,OAAnB,EAA2B;AACzB;;;;;;AAMA,OAAG,OAAOD,KAAP,KAAe,UAAlB,EAA6B;AACzBN,QAAGK,EAAH,CAAM,SAAN,EAAiBC,KAAjB,EAAwBE,IAAxB;AACH,IAFD,MAEM,IAAG,OAAOF,KAAP,KAAe,QAAlB,EAA2B;AAC7BrB,YAAOqB,KAAP,IAAgBC,OAAhB;AACAP,QAAGK,EAAH,CAAMC,KAAN,EAAaC,OAAb,EAAsBC,IAAtB;AAEH;AAEF;;AAKD;;;;AAIA;;;;;;;;;;AAUA,UAASC,QAAT,CAAkBC,SAAlB,EAA6BC,WAA7B,EAA0C;AACxC,OAAG;AACD;;;;;AAKAvB,UAAKE,MAAL,CAAYoB,SAAZ,IAAyBC,WAAzB;AACA;;;;AAIAvB,UAAKG,UAAL,GAAkBL,OAAO0B,MAAP,CAAcxB,KAAKG,UAAnB,EAA+BoB,YAAYpB,UAA3C,CAAlB;AACA;;;AAGAsB,cAASnB,IAAIE,KAAb,EAAoBe,YAAYG,MAAZ,CAAmBpB,IAAIE,KAAvB,CAApB;;AAGAK,UAAK,UAAL,EAAoBS,SAApB;AACA,YAAO,IAAP;AACD,IApBD,CAqBA,OAAOK,GAAP,EAAW;AACT,WAAM,IAAIC,KAAJ,CAAU,WAAV,EAAuBD,GAAvB,CAAN;AACA,YAAO,KAAP;AACD;AACF;;AAGD,UAASF,QAAT,CAAkBI,SAAlB,EAA6BC,UAA7B,EAAwC;AAC5BxB,OAAIE,KAAJ,GAAYqB,SAAZ;AACAvB,OAAIG,GAAJ,GAAUqB,UAAV;AACA,UAAO,IAAP;AACX;;AAED,UAASC,KAAT,CAAeC,IAAf,EAAoB;;AAElB,OAAGA,IAAH,EAAQ;AACJ1B,SAAII,GAAJ,GAAUsB,IAAV;AACH,IAFD,MAEK;AACF1B,SAAII,GAAJ,GAAUJ,IAAIG,GAAJ,CAAQH,IAAIK,GAAZ,CAAV;AACF;AACD;AACE;;;AAGF,QAAI,IAAIsB,GAAR,IAAe3B,IAAII,GAAnB,EAAuB;AACnB;;;;AAIA,SAAGuB,IAAIC,MAAJ,IAAY,CAAf,EAAiB;AACV,WAAIC,YAAYnC,KAAKG,UAAL,CAAgB8B,GAAhB,CAAhB;;AAEC,WAAIG,QAAQ9B,IAAII,GAAJ,CAAQuB,GAAR,CAAZ;AACApB,YAAK,OAAL,EAAc;AACTsB,6BADS;AAETC,qBAFS;AAGTC,iBAAQJ;AAHC,QAAd;AAOP,MAXD,MAWK;AACH;;;;;AAKArB,UAAGC,IAAH,CAAQoB,GAAR,EAAa3B,IAAII,GAAJ,CAAQuB,GAAR,CAAb;AACD;AACJ;AACDpB,QAAK,OAAL,EAAcP,IAAII,GAAlB;AAED;;AAID,UAAS4B,IAAT,GAAe;;AAGbhC,OAAIK,GAAJ,IAAS,CAAT;AACAoB;AACAlB,QAAK,MAAL;AACD;AACD,UAAS0B,IAAT,GAAe;;AAGbjC,OAAIK,GAAJ,IAAS,CAAT;AACAoB;AACAlB,QAAK,MAAL;AACD;;AAGD;;;SAIEI,E,GAAAA,E;SACAX,G,GAAAA,G;SACAN,I,GAAAA,I;SACAqB,Q,GAAAA,Q;SACAI,Q,GAAAA,Q;SACA1B,M,GAAAA,M;SACAF,M,GAAAA,M;SACAO,I,GAAAA,I;SACAkC,I,GAAAA,I;SACAC,I,GAAAA,I;SACAR,K,GAAAA,K;SACAlB,I,GAAAA,I;;;;;;;;;;;ACvMF,UAAS2B,MAAT,CAAgBC,MAAhB,EAAuB;AACrB,OAAIC,SAAS,EAAb;AAAA,OAAiBC,QAAQ,EAAzB;AACAF,YAASA,UAAU,IAAnB;AACA;;;AAGAA,UAAOxB,EAAP,GAAY,UAAS2B,IAAT,EAAeC,IAAf,EAAqBvC,GAArB,EAAyB;AACnC,MAACoC,OAAOE,IAAP,IAAeF,OAAOE,IAAP,KAAgB,EAAhC,EAAoCE,IAApC,CAAyC,CAACD,IAAD,EAAOvC,GAAP,CAAzC;AACD,IAFD;AAGA;;;AAGAmC,UAAOM,GAAP,GAAa,UAASH,IAAT,EAAeC,IAAf,EAAoB;AAC/BD,cAASF,SAAS,EAAlB;AACA,SAAIM,OAAON,OAAOE,IAAP,KAAgBD,KAA3B;AAAA,SACIM,IAAID,KAAKd,MAAL,GAAcW,OAAOG,KAAKd,MAAZ,GAAqB,CAD3C;AAEA,YAAMe,GAAN;AAAWJ,eAAQG,KAAKC,CAAL,EAAQ,CAAR,CAAR,IAAsBD,KAAKE,MAAL,CAAYD,CAAZ,EAAc,CAAd,CAAtB;AAAX;AACD,IALD;AAMA;;;AAGAR,UAAO5B,IAAP,GAAc,UAAS+B,IAAT,EAAc;AAC1B,SAAIO,IAAIT,OAAOE,IAAP,KAAgBD,KAAxB;AAAA,SAA+BK,OAAOG,EAAEjB,MAAF,GAAW,CAAX,GAAeiB,EAAEC,KAAF,CAAQ,CAAR,EAAWD,EAAEjB,MAAb,CAAf,GAAsCiB,CAA5E;AAAA,SAA+EF,IAAE,CAAjF;AAAA,SAAoFI,CAApF;AACA,YAAMA,IAAEL,KAAKC,GAAL,CAAR;AAAmBI,SAAE,CAAF,EAAKC,KAAL,CAAWD,EAAE,CAAF,CAAX,EAAiBV,MAAMS,KAAN,CAAYG,IAAZ,CAAiBC,SAAjB,EAA4B,CAA5B,CAAjB;AAAnB;AACD,IAHD;AAID;;mBAEchB,M","file":"../vnjson-cli/game-tpl/html/vendor/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c68cdebb95316be3dce8\n **/","\r\nimport Events from './minivents'; \r\n\r\nconst plugin = new Object();\r\nconst option = new Object();\r\n\r\nvar game = {\r\n    init: {},\r\n    scenes: {},\r\n    characters: {},\r\n    //choices: {},\r\n};\r\n\r\nconst util = {\r\n  pathNameSplit\r\n}\r\n\r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  scene:'scene',\r\n  label:'label',\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n/*\r\n * \r\n */\r\n\r\n\r\n\r\nvar ev = new Events();//EventEmitter\r\nvar { emit } = ev;\r\n\r\n/*\r\n *\r\n */\r\nfunction pathNameSplit(pathname){\r\n  let pathArr = pathname.split('/');\r\n  let scene = pathArr[0];\r\n  let label = pathArr[1];\r\n  return {label, scene};\r\n}\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\n/*\r\n * Объект plugin нужен для тестирования\r\n * что бы можно было вызывать плагин из\r\n * текущего окружения, а не плодить глобальные\r\n * методы.\r\n */ \r\n\r\nfunction on(event, handler){\r\n  /*\r\n   * Если функция vnjs.on(function(){})\r\n   * содержит callback без объявления\r\n   * имени события, то функция запускается\r\n   * в резиме autorun;\r\n   */\r\n  if(typeof event===\"function\"){\r\n      ev.on('autorun', event, vnjs);\r\n  }else if(typeof event===\"string\"){\r\n      plugin[event] = handler;\r\n      ev.on(event, handler, vnjs);\r\n      \r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\n * setScene\r\n */\r\n\r\n/*\r\n * @Функция принимает объект сцены\r\n *  {\r\n *    characters: {},\r\n *    assets: [{}]\r\n *    labels: {\r\n *         start: [{},{},{},{},{},{},{}],\r\n *    }\r\n *  }\r\n */\r\nfunction setScene(sceneName, sceneObject) {\r\n  try{\r\n    /*\r\n     * Назначаем полученные данные сцены в\r\n     * игровые объекты.\r\n     * А так же объекты внутреннего назначения\r\n     */\r\n    game.scenes[sceneName] = sceneObject;\r\n    /*\r\n     * Добавляю персонажей в каждой загруженной сцены\r\n     * в общий пулл.\r\n     */\r\n    game.characters = Object.assign(game.characters, sceneObject.characters);\r\n    /*\r\n     * Переопределяю методы текущего label'a\r\n     */\r\n    setLabel(ctx.label, sceneObject.labels[ctx.label])\r\n    \r\n\r\n    emit('setScene', `${sceneName} is defined!`);\r\n    return true;\r\n  }\r\n  catch (err){\r\n    throw new Error('setScene ', err);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\nfunction setLabel(labelName, labelArray){\r\n            ctx.label = labelName;\r\n            ctx.arr = labelArray;\r\n            return true;\r\n};\r\n\r\nfunction parse(_obj){\r\n\r\n  if(_obj){\r\n      ctx.obj = _obj;\r\n  }else{\r\n     ctx.obj = ctx.arr[ctx.num];\r\n  }\r\n  /** Текущий объект */\r\n    //ctx.obj = ctx.arr[ctx.num];\r\n\r\n\r\n  for(let key in ctx.obj){\r\n      /*\r\n       * Алиас персонажа содержит не больше трех (2)\r\n       * символов. \r\n       */\r\n      if(key.length<=2){\r\n             let character = game.characters[key];\r\n            \r\n              let reply = ctx.obj[key]; \r\n              emit('alias', {\r\n                   character,\r\n                   reply,\r\n                   aliase: key\r\n                 });\r\n             \r\n\r\n      }else{\r\n        /*\r\n         * vnjs.on('alert')\r\n         * Подписывает пользовательские плагины\r\n         * \r\n         */\r\n        ev.emit(key, ctx.obj[key]);\r\n      }\r\n  }\r\n  emit('parse', ctx.obj);\r\n\r\n};\r\n\r\n\r\n\r\nfunction next(){\r\n  \r\n  \r\n  ctx.num+=1;\r\n  parse();\r\n  emit('next');\r\n};\r\nfunction prev(){\r\n \r\n  \r\n  ctx.num-=1;\r\n  parse();\r\n  emit('prev');\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  game,\r\n  setScene,\r\n  setLabel,\r\n  option,\r\n  plugin,\r\n  util,\r\n  next,\r\n  prev,\r\n  parse,\r\n  emit\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/","function Events(target){\r\n  var events = {}, empty = [];\r\n  target = target || this;\r\n  /**\r\n   *  On: listen to events\r\n   */\r\n  target.on = function(type, func, ctx){\r\n    (events[type] = events[type] || []).push([func, ctx]);\r\n  };\r\n  /**\r\n   *  Off: stop listening to event / specific callback\r\n   */\r\n  target.off = function(type, func){\r\n    type || (events = {});\r\n    var list = events[type] || empty,\r\n        i = list.length = func ? list.length : 0;\r\n    while(i--) func == list[i][0] && list.splice(i,1);\r\n  };\r\n  /** \r\n   * Emit: send event, callbacks will be triggered\r\n   */\r\n  target.emit = function(type){\r\n    var e = events[type] || empty, list = e.length > 0 ? e.slice(0, e.length) : e, i=0, j;\r\n    while(j=list[i++]) j[0].apply(j[1], empty.slice.call(arguments, 1));\r\n  };\r\n};\r\n\r\nexport default Events;\n\n\n/** WEBPACK FOOTER **\n ** ./src/minivents.js\n **/"],"sourceRoot":""}